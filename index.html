<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG変形ツール</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <input type="file" id="svgFile" accept=".svg">
    <div id="originalSvgContainer" class="svg-container"></div>
    <div id="modifiedSvgContainer" class="svg-container"></div>
    <div>
        <label for="complexity">複雑性: </label>
        <input type="range" id="complexity" min="0" max="100" value="50">
    </div>
    <div>
        <label for="linearity">直線性: </label>
        <input type="range" id="linearity" min="0" max="100" value="50">
    </div>
    <div>
        <label for="amplitude">振幅: </label>
        <input type="range" id="amplitude" min="0" max="100" value="50">
    </div>
    <div>
        <label for="symmetry">対称性: </label>
        <input type="range" id="symmetry" min="0" max="100" value="50">
    </div>
    <button id="saveButton">保存</button>
    <script src="script.js"></script>
</body>
</html>

.svg-container {
    display: inline-block;
    width: 45%;
    height: 300px;
    border: 1px solid #ccc;
    margin: 10px;
}

let originalSvgData;
let modifiedSvgData;

document.getElementById('svgFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        originalSvgData = e.target.result;
        document.getElementById('originalSvgContainer').innerHTML = originalSvgData;
        modifiedSvgData = originalSvgData;
        updateSVG();
    };
    reader.readAsText(file);
});

['complexity', 'linearity', 'amplitude', 'symmetry'].forEach(param => {
    document.getElementById(param).addEventListener('input', updateSVG);
});

function updateSVG() {
    if (!originalSvgData) return;

    const complexity = document.getElementById('complexity').value;
    const linearity = document.getElementById('linearity').value;
    const amplitude = document.getElementById('amplitude').value;
    const symmetry = document.getElementById('symmetry').value;

    const parser = new DOMParser();
    const svgDoc = parser.parseFromString(originalSvgData, 'image/svg+xml');
    const paths = svgDoc.querySelectorAll('path');

    paths.forEach(path => {
        let d = path.getAttribute('d');
        
        d = adjustComplexity(d, complexity);
        d = adjustLinearity(d, linearity);
        d = adjustAmplitude(d, amplitude);
        d = adjustSymmetry(d, symmetry);

        path.setAttribute('d', d);
    });

    modifiedSvgData = new XMLSerializer().serializeToString(svgDoc);
    document.getElementById('modifiedSvgContainer').innerHTML = modifiedSvgData;
}

function adjustComplexity(d, complexity) {
    // TODO: 複雑さに応じてパスのポイントを追加または削除
    return d;
}

function adjustLinearity(d, linearity) {
    // TODO: 直線性に応じて曲線の制御点を調整
    return d;
}

function adjustAmplitude(d, amplitude) {
    // TODO: 振幅に応じてパスの各ポイントの座標を拡大縮小
    return d;
}

function adjustSymmetry(d, symmetry) {
    // TODO: 対称性に応じてパスの左右や上下の対称性を調整
    return d;
}

document.getElementById('saveButton').addEventListener('click', function() {
    const blob = new Blob([modifiedSvgData], {type: 'image/svg+xml'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'modified_svg.svg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
