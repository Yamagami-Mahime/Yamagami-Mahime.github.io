<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG図形変形ツール（400px×400px版）</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #controls { margin-bottom: 20px; }
        input { margin-right: 10px; }
        #svgContainer { border: 2px solid black; }
    </style>
</head>
<body>
    <h1>SVG図形変形ツール</h1>
    <div id="controls">
        <input type="file" id="svgFile" accept=".svg">
        <input type="range" id="vertexCount" min="3" max="50" value="20">
        <label for="vertexCount">頂点数: <span id="vertexCountValue">20</span></label>
        <input type="range" id="roundness" min="0" max="100" value="0">
        <label for="roundness">丸み: <span id="roundnessValue">0</span></label>
        <input type="range" id="rotation" min="0" max="360" value="0">
        <label for="rotation">回転: <span id="rotationValue">0</span>°</label>
    </div>
    <svg id="svgContainer" width="400" height="400"></svg>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.1/svg.min.js"></script>
    <script>
        let svgContainer;
        let originalShape;
        let transformedShape;

        document.addEventListener('DOMContentLoaded', () => {
            svgContainer = SVG('#svgContainer').size(400, 400);

            document.getElementById('svgFile').addEventListener('change', handleSVGFile);
            document.getElementById('vertexCount').addEventListener('input', updateShape);
            document.getElementById('roundness').addEventListener('input', updateShape);
            document.getElementById('rotation').addEventListener('input', updateShape);
        });

        function handleSVGFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const svgText = e.target.result;
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');

                // 既存のSVGをクリアして、新しいSVG要素を追加
                svgContainer.clear();
                const importedSVG = svgContainer.svg(svgDoc.documentElement.outerHTML);

                // 初期形状を保存
                originalShape = importedSVG;
                transformedShape = originalShape.clone();

                // 最初の変形を適用
                updateShape();
            };
            reader.readAsText(file);
        }

        function updateShape() {
            if (!originalShape) return;

            const vertexCount = parseInt(document.getElementById('vertexCount').value);
            const roundness = parseInt(document.getElementById('roundness').value) / 100;
            const rotation = parseInt(document.getElementById('rotation').value) * Math.PI / 180;

            document.getElementById('vertexCountValue').textContent = vertexCount;
            document.getElementById('roundnessValue').textContent = roundness * 100;
            document.getElementById('rotationValue').textContent = (rotation * (180 / Math.PI)).toFixed(0);

            // スケーリングや回転などの変形を適用
            transformedShape.transform({
                rotate: rotation * (180 / Math.PI), // 回転を適用
                scale: 1 + roundness // 丸みを調整
            });
        }
    </script>
</body>
</html>
