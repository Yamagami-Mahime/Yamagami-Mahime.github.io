<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ランダム図形変形ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { display: flex; flex-direction: column; align-items: center; }
        #controls { margin-top: 20px; }
        .slider { width: 200px; }
    </style>
</head>
<body>
    <div id="shape-container"></div>
    <div id="controls">
        <button id="generate-btn">新しい図形を生成</button>
        <div>
            <label for="scale">拡大縮小:</label>
            <input type="range" id="scale" class="slider" min="0.1" max="2" step="0.1" value="1">
        </div>
        <div>
            <label for="rotation">回転:</label>
            <input type="range" id="rotation" class="slider" min="0" max="360" value="0">
        </div>
        <div>
            <label for="complexity">複雑さ:</label>
            <input type="range" id="complexity" class="slider" min="3" max="20" value="5">
        </div>
        <div>
            <label for="distortion">歪み:</label>
            <input type="range" id="distortion" class="slider" min="0" max="1" step="0.1" value="0">
        </div>
    </div>
    <button id="save-btn">PNG保存</button>

    <script>
        let shapes = [];
        let selectedShape;
        let canvas;

        function setup() {
            canvas = createCanvas(600, 400);
            canvas.parent('shape-container');
            generateShapes();
            noLoop();
        }

        function draw() {
            background(220);
            if (selectedShape) {
                drawShape(selectedShape);
            } else {
                for (let shape of shapes) {
                    drawShape(shape);
                }
            }
        }

        function generateShapes() {
            shapes = [];
            for (let i = 0; i < 30; i++) {
                shapes.push({
                    x: random(width),
                    y: random(height),
                    complexity: floor(random(3, 10)),
                    radius: random(20, 50),
                    rotation: random(360),
                    distortion: random(0.5)
                });
            }
            selectedShape = null;
            redraw();
        }

        function drawShape(shape) {
            push();
            translate(shape.x, shape.y);
            rotate(radians(shape.rotation));
            beginShape();
            for (let i = 0; i < shape.complexity; i++) {
                let angle = map(i, 0, shape.complexity, 0, TWO_PI);
                let r = shape.radius * (1 + sin(angle * shape.complexity) * shape.distortion);
                let x = r * cos(angle);
                let y = r * sin(angle);
                vertex(x, y);
            }
            endShape(CLOSE);
            pop();
        }

        canvas.mousePressed = function() {
            for (let shape of shapes) {
                let d = dist(mouseX, mouseY, shape.x, shape.y);
                if (d < shape.radius) {
                    selectedShape = shape;
                    updateControls();
                    redraw();
                    break;
                }
            }
        }

        function updateControls() {
            document.getElementById('scale').value = 1;
            document.getElementById('rotation').value = selectedShape.rotation;
            document.getElementById('complexity').value = selectedShape.complexity;
            document.getElementById('distortion').value = selectedShape.distortion;
        }

        document.getElementById('generate-btn').addEventListener('click', generateShapes);

        document.getElementById('scale').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.radius = this.value * 50;
                redraw();
            }
        });

        document.getElementById('rotation').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.rotation = this.value;
                redraw();
            }
        });

        document.getElementById('complexity').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.complexity = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('distortion').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.distortion = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('save-btn').addEventListener('click', function() {
            saveCanvas(canvas, 'my_shape', 'png');
        });
    </script>
</body>
</html>
