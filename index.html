<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG形状編集ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.2/svg.min.js"></script>
    <style>
        #svg-container { width: 500px; height: 500px; border: 1px solid black; }
        .control-panel { margin-top: 20px; }
        .slider { width: 200px; }
    </style>
</head>
<body>
    <input type="file" id="file-input" accept=".svg">
    <div id="svg-container"></div>
    <div class="control-panel">
        <div>
            <label for="points">頂点数: </label>
            <input type="range" id="points" class="slider" min="3" max="20" value="5">
        </div>
        <div>
            <label for="radius">半径: </label>
            <input type="range" id="radius" class="slider" min="10" max="200" value="100">
        </div>
        <div>
            <label for="rotation">回転: </label>
            <input type="range" id="rotation" class="slider" min="0" max="360" value="0">
        </div>
        <div>
            <label for="distortion">歪み: </label>
            <input type="range" id="distortion" class="slider" min="0" max="100" value="0">
        </div>
    </div>
    <button id="save-btn">SVGを保存</button>

    <script>
        let draw, shape;
        const container = document.getElementById('svg-container');

        document.getElementById('file-input').addEventListener('change', loadSVG);
        document.getElementById('points').addEventListener('input', updateShape);
        document.getElementById('radius').addEventListener('input', updateShape);
        document.getElementById('rotation').addEventListener('input', updateShape);
        document.getElementById('distortion').addEventListener('input', updateShape);
        document.getElementById('save-btn').addEventListener('click', saveSVG);

        function loadSVG(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                container.innerHTML = e.target.result;
                const svg = container.querySelector('svg');
                draw = SVG(svg);
                shape = draw.select('path').first();
                updateShape();
            };

            reader.readAsText(file);
        }

        function updateShape() {
            if (!shape) return;

            const points = document.getElementById('points').value;
            const radius = document.getElementById('radius').value;
            const rotation = document.getElementById('rotation').value;
            const distortion = document.getElementById('distortion').value / 100;

            let d = '';
            for (let i = 0; i < points; i++) {
                const angle = (i / points) * Math.PI * 2 + rotation * Math.PI / 180;
                const x = 250 + Math.cos(angle) * radius * (1 + Math.sin(i) * distortion);
                const y = 250 + Math.sin(angle) * radius * (1 + Math.cos(i) * distortion);
                d += (i === 0 ? 'M' : 'L') + x + ',' + y;
            }
            d += 'Z';

            shape.plot(d);
        }

        function saveSVG() {
            const svgData = container.innerHTML;
            const blob = new Blob([svgData], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'modified_shape.svg';
            link.click();
        }
    </script>
</body>
</html>
