<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>図形変形ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        #shape-selector { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; }
        .shape-option { cursor: pointer; padding: 10px; border: 1px solid #ccc; }
        #canvas-container { border: 2px solid #000; margin-bottom: 20px; }
        #controls { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .slider-container { width: 80%; margin: 10px 0; }
        .slider { width: 100%; }
    </style>
</head>
<body>
    <div id="shape-selector"></div>
    <div id="canvas-container"></div>
    <div id="controls">
        <div class="slider-container">
            <label for="complexity">複雑性:</label>
            <input type="range" id="complexity" class="slider" min="3" max="20" value="5">
        </div>
        <div class="slider-container">
            <label for="curvature">曲線性:</label>
            <input type="range" id="curvature" class="slider" min="0" max="1" step="0.1" value="0">
        </div>
        <div class="slider-container">
            <label for="elongation">細長性:</label>
            <input type="range" id="elongation" class="slider" min="0.5" max="2" step="0.1" value="1">
        </div>
        <div class="slider-container">
            <label for="rotation">角度:</label>
            <input type="range" id="rotation" class="slider" min="0" max="360" value="0">
        </div>
    </div>
    <button id="save-btn">PNG保存</button>

    <script>
        let shapes = [];
        let selectedShape;
        let canvas;

        function setup() {
            canvas = createCanvas(400, 400);
            canvas.parent('canvas-container');
            generateShapes();
            createShapeSelector();
            noLoop();
        }

        function draw() {
            background(220);
            if (selectedShape) {
                drawShape(selectedShape);
            }
        }

        function generateShapes() {
            shapes = [];
            for (let i = 0; i < 10; i++) {
                shapes.push({
                    complexity: floor(random(3, 10)),
                    curvature: random(1),
                    elongation: random(0.5, 2),
                    rotation: random(360)
                });
            }
        }

        function createShapeSelector() {
            const selector = document.getElementById('shape-selector');
            shapes.forEach((shape, index) => {
                const option = document.createElement('div');
                option.className = 'shape-option';
                option.innerHTML = `形${index + 1}`;
                option.onclick = () => selectShape(shape);
                selector.appendChild(option);
            });
        }

        function selectShape(shape) {
            selectedShape = shape;
            updateControls();
            redraw();
        }

        function drawShape(shape) {
            push();
            translate(width / 2, height / 2);
            rotate(radians(shape.rotation));
            beginShape();
            for (let i = 0; i < shape.complexity; i++) {
                let angle = map(i, 0, shape.complexity, 0, TWO_PI);
                let r = 150 * shape.elongation * (1 + sin(angle * shape.complexity) * shape.curvature);
                let x = r * cos(angle);
                let y = r * sin(angle);
                curveVertex(x, y);
            }
            endShape(CLOSE);
            pop();
        }

        function updateControls() {
            document.getElementById('complexity').value = selectedShape.complexity;
            document.getElementById('curvature').value = selectedShape.curvature;
            document.getElementById('elongation').value = selectedShape.elongation;
            document.getElementById('rotation').value = selectedShape.rotation;
        }

        document.getElementById('complexity').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.complexity = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('curvature').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.curvature = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('elongation').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.elongation = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('rotation').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.rotation = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('save-btn').addEventListener('click', function() {
            saveCanvas(canvas, 'my_shape', 'png');
        });
    </script>
</body>
</html>
