<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ことばのカタチ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        #shape-selector { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; }
        .shape-option { cursor: pointer; width: 60px; height: 60px; border: 1px solid #ccc; }
        #canvas-container { border: 2px solid #000; margin-bottom: 20px; }
        #controls { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .slider-container { width: 80%; margin: 10px 0; }
        .slider { width: 100%; }
    </style>
</head>
<body>
    <div id="shape-selector"></div>
    <div id="canvas-container"></div>
    <div id="controls">
        <div class="slider-container">
            <label for="complexity">複雑性:</label>
            <input type="range" id="complexity" class="slider" min="3" max="20" value="5">
        </div>
        <div class="slider-container">
            <label for="roundness">丸み具合:</label>
            <input type="range" id="roundness" class="slider" min="0" max="30" step="1" value="0">
        </div>
        <div class="slider-container">
            <label for="aspectRatio">縦横比:</label>
            <input type="range" id="aspectRatio" class="slider" min="1" max="15" step="1" value="0">
        </div>
        <div class="slider-container">
            <label for="rotation">角度:</label>
            <input type="range" id="rotation" class="slider" min="0" max="360" value="0">
        </div>
    </div>
    <button id="save-btn">PNG保存</button>

    <script>
        let shapes = [];
        let selectedShape;
        let canvas;
        let selectorCanvases = [];

        function setup() {
            canvas = createCanvas(400, 400);
            canvas.parent('canvas-container');
            generateShapes();
            createShapeSelector();
            noLoop();
        }

        function draw() {
            background(220);
            if (selectedShape) {
                drawShape(selectedShape, width/2, height/2, 150);
            }
        }

        function generateShapes() {
            shapes = [
                { complexity: 3, roundness: 0, aspectRatio: 1, rotation: 0 },    // 三角形
                { complexity: 4, roundness: 0, aspectRatio: 1, rotation: 45 },   // 正方形
                { complexity: 5, roundness: 0.2, aspectRatio: 1, rotation: 0 },  // 五角形
                { complexity: 6, roundness: 0.5, aspectRatio: 1.2, rotation: 0 },// 六角形
                { complexity: 8, roundness: 0.8, aspectRatio: 1, rotation: 0 },  // 八角形
                { complexity: 10, roundness: 0.3, aspectRatio: 1.5, rotation: 0 },// 星形
                { complexity: 12, roundness: 1, aspectRatio: 1, rotation: 0 },   // 円形
                { complexity: 7, roundness: 0.7, aspectRatio: 1.8, rotation: 45 },// 変形七角形
                { complexity: 15, roundness: 0.5, aspectRatio: 1.2, rotation: 90 },// 複雑な形
                { complexity: 20, roundness: 0.9, aspectRatio: 0.7, rotation: 0 } // 非常に複雑な形
            ];
        }

        function createShapeSelector() {
            const selector = document.getElementById('shape-selector');
            shapes.forEach((shape, index) => {
                const option = document.createElement('div');
                option.className = 'shape-option';
                const selectorCanvas = createGraphics(60, 60);
                selectorCanvases.push(selectorCanvas);
                drawShape(shape, 30, 30, 25, selectorCanvas);
                option.appendChild(selectorCanvas.canvas);
                option.onclick = () => selectShape(shape);
                selector.appendChild(option);
            });
        }

        function selectShape(shape) {
            selectedShape = shape;
            updateControls();
            redraw();
        }

        function drawShape(shape, centerX, centerY, size, targetCanvas = window) {
            targetCanvas.push();
            targetCanvas.translate(centerX, centerY);
            targetCanvas.rotate(radians(shape.rotation));
            targetCanvas.beginShape();
            for (let i = 0; i < shape.complexity; i++) {
                let angle = map(i, 0, shape.complexity, 0, TWO_PI);
                let r = size * (1 + sin(angle * shape.complexity) * shape.roundness);
                let x = r * cos(angle) * shape.aspectRatio;
                let y = r * sin(angle) / shape.aspectRatio;
                targetCanvas.curveVertex(x, y);
            }
            targetCanvas.endShape(CLOSE);
            targetCanvas.pop();
        }

        function updateControls() {
            document.getElementById('complexity').value = selectedShape.complexity;
            document.getElementById('roundness').value = selectedShape.roundness;
            document.getElementById('aspectRatio').value = selectedShape.aspectRatio;
            document.getElementById('rotation').value = selectedShape.rotation;
        }

        document.getElementById('complexity').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.complexity = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('roundness').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.roundness = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('aspectRatio').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.aspectRatio = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('rotation').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.rotation = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('save-btn').addEventListener('click', function() {
            saveCanvas(canvas, 'my_shape', 'png');
        });
    </script>
</body>
</html>
