<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ことばのカタチ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        #shape-selector { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; }
        .shape-option { cursor: pointer; width: 60px; height: 60px; border: 1px solid #ccc; }
        #canvas-container { border: 2px solid #000; margin-bottom: 20px; }
        #controls { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .slider-container { width: 80%; margin: 10px 0; }
        .slider { width: 100%; }
    </style>
</head>
<body>
    <div id="shape-selector"></div>
    <div id="canvas-container"></div>
    <div id="controls">
        <div class="slider-container">
            <label for="curvature">曲線性:</label>
            <input type="range" id="curvature" class="slider" min="0" max="30" step="1" value="0">
        </div>
        <div class="slider-container">
            <label for="aspectRatio">細長性:</label>
            <input type="range" id="aspectRatio" class="slider" min="1" max="15" step="1" value="1">
        </div>
        <div class="slider-container">
            <label for="symmetry">対称性:</label>
            <input type="range" id="symmetry" class="slider" min="0" max="1" step="0.1" value="1">
        </div>
        <div class="slider-container">
            <label for="rotation">角度:</label>
            <input type="range" id="rotation" class="slider" min="0" max="360" value="0">
        </div>
    </div>
    <button id="save-btn">PNG保存</button>

    <script>
        let shapes = [];
        let selectedShape;
        let canvas;
        let selectorCanvases = [];

        function setup() {
            canvas = createCanvas(400, 400);
            canvas.parent('canvas-container');
            generateShapes();
            createShapeSelector();
            noLoop();
        }

        function draw() {
            background(220);
            if (selectedShape) {
                drawShape(selectedShape, width / 2, height / 2, 150);
            }
        }

        function generateShapes() {
            shapes = [
                { curvature: 0.2, aspectRatio: 1.5, symmetry: 1, rotation: 0 },    // Shape 1
                { curvature: 0.5, aspectRatio: 0.8, symmetry: 0.6, rotation: 45 }, // Shape 2
                { curvature: 0.3, aspectRatio: 1.2, symmetry: 0.9, rotation: 0 },  // Shape 3
                { curvature: 0.7, aspectRatio: 2, symmetry: 0.4, rotation: 90 },   // Shape 4
                { curvature: 0.9, aspectRatio: 1, symmetry: 0.5, rotation: 180 }   // Shape 5
            ];
        }

        function createShapeSelector() {
            const selector = document.getElementById('shape-selector');
            shapes.forEach((shape, index) => {
                const option = document.createElement('div');
                option.className = 'shape-option';
                const selectorCanvas = createGraphics(60, 60);
                selectorCanvases.push(selectorCanvas);
                drawShape(shape, 30, 30, 25, selectorCanvas);
                option.appendChild(selectorCanvas.canvas);
                option.onclick = () => selectShape(shape);
                selector.appendChild(option);
            });
        }

        function selectShape(shape) {
            selectedShape = shape;
            updateControls();
            redraw();
        }

        function drawShape(shape, centerX, centerY, size, targetCanvas = window) {
            targetCanvas.push();
            targetCanvas.translate(centerX, centerY);
            targetCanvas.rotate(radians(shape.rotation));
            targetCanvas.beginShape();
            for (let i = 0; i < 20; i++) {
                let angle = map(i, 0, 20, 0, TWO_PI);
                let r = size * (1 + sin(angle) * shape.curvature);
                let x = r * cos(angle) * shape.aspectRatio;
                let y = r * sin(angle) * (shape.symmetry ? 1 : sin(angle) * shape.symmetry);
                targetCanvas.vertex(x, y);
            }
            targetCanvas.endShape(CLOSE);
            targetCanvas.pop();
        }

        function updateControls() {
            document.getElementById('curvature').value = selectedShape.curvature;
            document.getElementById('aspectRatio').value = selectedShape.aspectRatio;
            document.getElementById('symmetry').value = selectedShape.symmetry;
            document.getElementById('rotation').value = selectedShape.rotation;
        }

        document.getElementById('curvature').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.curvature = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('aspectRatio').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.aspectRatio = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('symmetry').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.symmetry = parseFloat(this.value);
                redraw();
            }
        });

        document.getElementById('rotation').addEventListener('input', function() {
            if (selectedShape) {
                selectedShape.rotation = parseInt(this.value);
                redraw();
            }
        });

        document.getElementById('save-btn').addEventListener('click', function() {
            saveCanvas(canvas, 'my_shape', 'png');
        });
    </script>
</body>
</html>
